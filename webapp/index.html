<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf=8">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
	<title>AR Demo</title>
	<script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
	<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.2/aframe/build/aframe-ar.js"></script>
	<script src="https://unpkg.com/aframe-html-shader@0.2.0/dist/aframe-html-shader.js"></script>
	<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
	<!-- init sapui5 bootstrap-->
	<script id="sap-ui-bootstrap" 
			src="https://openui5.hana.ondemand.com/resources/sap-ui-core.js"
			data-sap-ui-theme="sap_fiori_3_dark" 
			data-sap-ui-resourceroots='{"sap.ui.demo.basicTemplate": "./"}' 
			data-sap-ui-oninit="module:sap/ui/core/ComponentSupport" 
			data-sap-ui-compatVersion="edge" 
			data-sap-ui-async="true"
			data-sap-ui-frameOptions="trusted">
		</script>
	<link rel="stylesheet" href="/css/style.css">
</head>

<body>
	<a-scene embedded arjs='debugUIEnabled:false;' vr-mode-ui="enabled: false">
		<div id="sap" data-sap-ui-component data-name="sap.ui.demo.basicTemplate" data-id="container" data-settings='{"id" : "KidDiary"}'></div>
		<div id="poster">
			<h3>Hello!</h3>
		</div>

		<a-assets>
			<img id="img" src="./img/robin.png">
		</a-assets>
		
		<a-marker preset="hiro">
			<a-plane width="1" height="1" rotation="-90 0 0" material="shader:html; target: #poster"></a-plane>
			<a-image 
            rotation="-90 0 0"
			position="1 0 0"
            src="#img"></a-image>
		</a-marker>

		<a-entity camera></a-entity>
	</a-scene>
</body>
<script>
	var resizedCanvas = document.createElement("canvas");
	var resizedContext = resizedCanvas.getContext("2d");
	var width = element.clientWidth;
	var height = element.clientHeight;
	var aScene = document.querySelector("a-scene").components.screenshot.getCanvas("perspective");

	if (width && height) {
		//videoのサイズをキャンバスにセット
		resizedCanvas.width = width;
		resizedCanvas.height = height;

		//カメラの画角でar側の縮小処理を変える
		if (width > height) {
			// 横長（PC)
			resizedContext.draw(aScene, 0, 0, width, height);
		} else {
			// 縦長（スマホ）
			var scale = height / width;
			var scaledWidth = height * scale;
			var marginLeft = (width - scaledWidth) / 2;
			resizedContext.drawImage(aScene, marginLeft, 0, scaledWidth, height);
		}
		return resizedCanvas.toDataURL('image/png');
	}
</script>

</html>